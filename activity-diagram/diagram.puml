@startuml
skinparam style strict
skinparam activity {
  DiamondPadding 18
  BackgroundColor #f9f9f9
  BorderColor #777
}
skinparam partition {
  BackgroundColor #ffffff
  BorderColor #444
}

partition "Клієнт" {
  start
  :Виникнення кризової ситуації;
  :Подання запиту;
}

partition "Адміністратор" {
  :Отримання та реєстрація запиту;
  :Фіксація часу та контактів;
  :Оцінка терміновості;
}

if (Спеціаліст доступний?) then (Так)

  partition "Адміністратор" {
    :Призначення спеціаліста;
  }

  partition "Спеціаліст" {
    :Отримання сповіщення;
    :Перегляд інформації;
  }

  if (Потрібна додаткова інформація?) then (Так)
    partition "Адміністратор" {
      :Збір додаткових даних;
    }
    partition "Спеціаліст" {
      :Аналіз інформації;
    }
  else (Ні)
    partition "Спеціаліст" {
      :Інформації достатньо;
    }
  endif

  fork
    partition "Спеціаліст" {
      :Підготовка матеріалів;
      :Встановлення контакту;
    }
  fork again
    partition "Адміністратор" {
      :Формування деталей сесії;
      :Надсилання підтвердження;
    }
    partition "Клієнт" {
      :Отримання підтвердження;
      :Підготовка до сесії;
    }
  end fork

  partition "Спеціаліст" {
    :Проведення сесії (60–90 хв);
    :Оцінка стану після сесії;
  }

  partition "Клієнт" {
    :Участь у сесії;
  }

  if (Потрібне подальше спостереження?) then (Так)
    partition "Спеціаліст" {
      :План подальшої терапії;
    }
    partition "Адміністратор" {
      :Створення графіка;
    }
    partition "Клієнт" {
      :Отримання плану;
    }
    partition "Спеціаліст" {
      :Документування;
    }
  else (Ні)
    partition "Спеціаліст" {
      :Рекомендації для самодопомоги;
    }
    partition "Клієнт" {
      :Отримання матеріалів;
    }
    partition "Спеціаліст" {
      :Документування;
    }
  endif

  partition "Адміністратор" {
    :Оновлення записів;
    :Закриття запиту (Виконано);
  }

  partition "Клієнт" {
    stop
  }

else (Ні)

  partition "Адміністратор" {
    :Аналіз альтернатив;
  }

  if (Можливе швидке перенаправлення?) then (Так)

    partition "Адміністратор" {
      :Пошук альтернативи;
    }

    if (Альтернатива знайдена?) then (Так)
      partition "Адміністратор" {
        :Координація перенаправлення;
      }
      partition "Клієнт" {
        :Отримання контактів;
        :Звернення до партнерів;
      }
      partition "Адміністратор" {
        :Фіксація;
        :Закриття (Перенаправлено);
      }
      partition "Клієнт" {
        stop
      }
    else (Ні)
      partition "Адміністратор" {
        :Постановка у пріоритетну чергу;
        :Надання тимчасових ресурсів;
      }
      partition "Клієнт" {
        :Отримання ресурсів;
        :Очікування;
      }
      partition "Адміністратор" {
        :Моніторинг черги;
        :Повторний пошук;
      }
      note right
        При появі спеціаліста процес переходить
        до етапу "Призначення спеціаліста"
      end note
      detach
    endif

  else (Ні)

    partition "Адміністратор" {
      :Постановка у чергу;
      :Інформування клієнта;
      :Надання ресурсів;
    }
    partition "Клієнт" {
      :Очікування;
    }
    partition "Адміністратор" {
      :Моніторинг;
    }
    note right
      При появі спеціаліста процес переходить
      до етапу "Призначення спеціаліста"
    end note
    detach

  endif

endif

@enduml
